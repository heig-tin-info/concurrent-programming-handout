\documentclass[a4paper, 11pt, onecolumn, twoside, openright]{report}

\usepackage[french]{babel}
\usepackage{color}
\usepackage{frbib}
\usepackage{booktabs}
\usepackage{fontspec}
\usepackage{amsfonts}
\usepackage{lettrine}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{amstext}
\usepackage{subfigure}
\usepackage{heiglogo}
\usepackage{listings}
\usepackage[chapter]{algorithm}
\usepackage{algorithmic}
\usepackage{tabularx}
\usepackage{fancyhdr}
\usepackage{ulem}
\usepackage{xpatch}
\usepackage{xcolor}
\usepackage{realboxes}
\usepackage[labelfont=bf]{caption}
\usepackage{fontspec}
\usepackage{tcolorbox}
\usepackage{geometry}
\usepackage[subfigure]{tocloft}

\setmonofont{inconsolata}

\geometry{hmargin=2.5cm,vmargin=2.5cm}

\setlength{\parskip}{1em}

\definecolor{GitHubGray}{rgb}{0.9,0.9,0.9}

\lstset{
    language=c,
    breaklines=true,
    basicstyle=\ttfamily\footnotesize\color{black},
    keywordstyle=\bfseries,
    commentstyle=\itshape\color{green!40!black},
    keepspaces=true,
    showspaces=false,
    showtabs=true,
    tabsize=2,
    upquote=true,
    aboveskip=2pt,
    belowskip=2pt,
    framexleftmargin=2pt,
    extendedchars=true,
    inputencoding=utf8,
    literate=
    {à}{{\`a}}1
    {è}{{\`e}}1
    {é}{{\'e}}1
    {É}{{\'E}}1
    {ê}{{\^e}}1
    {î}{{\^i}}1
    {ö}{{\"o}}1
    {°}{\textdegree}1
    {ç}{{\c{c}}}1
}

\tcbuselibrary{listings, breakable, skins}

\renewcommand{\lstlistingname}{Code}
\renewcommand{\lstlistlistingname}{Liste des sources}

% \renewcommand*\thelstnumber{\makebox[3em][r]{\ifnum\value{lstnumber}<10 0\fi\the\value{lstnumber}}}

\AtBeginDocument{%
\newtcblisting[blend into=listings]{codeblock}[1][]{%
  colback=GitHubGray,
  colframe=black!70,
  enhanced,
  listing only,
  boxrule=0.5pt,
  listing remove caption=false,
  listing options={
    language=c,
    breaklines=true,
    keywordstyle=\bfseries\color{black},
    basicstyle=\ttfamily\color{black}\fontsize{9pt}{10pt}\selectfont,
    emphstyle={\em \color{gray}},
    keepspaces=true,
    showspaces=false,
    showtabs=true,
    tabsize=2,
    upquote=true,
    framexleftmargin=2pt,
    extendedchars=true,
    inputencoding=utf8
  },
  coltitle=black,
  attach boxed title to bottom center={yshift=-10pt},
  boxed title style={enhanced jigsaw, colback=white, sharp corners, boxrule=0pt},
  #1
}
}

\newcommand{\ccode}[1]{{\lstset{basicstyle=\normalsize\ttfamily,stringstyle=\ttfamily}\lstinline$#1$}}

\makeatletter
\xpretocmd\lstinline{\Colorbox{GitHubGray}\bgroup\appto\lst@DeInit{\egroup}}{}{}
\makeatother

\floatname{algorithm}{Algorithme}

\graphicspath{{./images/}}

\newcommand{\com}[1]{}
\newcommand{\ang}[1]{\textit{#1}}

\setlength{\headheight}{1.2cm}
\addtolength{\topmargin}{-1.6pt}

\newcounter{exercicecounter}
\setcounter{exercicecounter}{1}

\newcommand{\extitle}[1]{\centering{\Huge #1}\vspace{1cm}}

\newenvironment{exercice}[1][]{{%
  \noindent%
  \begin{minipage}[l]{\linewidth}%
    \vspace{8mm}%
    \rule{\linewidth}{0.2mm} \\%
    %%\vspace{1mm}%
    \large\textbf{Exercice \theexercicecounter :} #1\\ %
    \rule{\linewidth}{0.2mm}%
    \vspace{5mm}%
    \addtocounter{exercicecounter}{1}%
  \end{minipage}}}{}

\newcommand{\startexercice}{\subsection*{Exercice \thechapter.\theexercicecounter}\addtocounter{exercicecounter}{1}}

\newcommand{\startchapter}{\thispagestyle{myplain}
\setcounter{exercicecounter}{1}}

\setlength{\unitlength}{1cm}

\pagestyle{fancy}
\renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{\chaptername}\ \thechapter.\ \MakeUppercase{#1}}{}}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}
\fancyhead[RO]{\thepage}
\fancyhead[LE]{\thepage}
\fancyhead[LO]{\rightmark}
\fancyhead[RE]{\leftmark}
\fancyheadoffset[LE,RO]{1.5cm} \fancyfootoffset[LE,RO]{1.5cm}

\fancypagestyle{myplain}{%
\renewcommand{\headrulewidth}{0pt}
\fancyhead{}
}

\emergencystretch=50pt

\renewcommand{\labelitemi}{$\bullet$}

\setcounter{tocdepth}{2}
\setcounter{secnumdepth}{2}

\setlength{\parindent}{0pt}

\begin{document}

\begin{titlepage}
  \logo{1cm}{1cm}
  \centering \vspace*{\fill}%

  {\Huge \scshape Introduction à la\\\vspace{1em}Programmation Concurrente}\par
  \vspace{5em}%
  {\Large Polycopié du cours PCO}\par
  \vspace{5em}%
  \upshape\par
  {\Large Prof. Claude Evéquoz, Prof. Yann Thoma, Prof. Yves Chevallier }%
  \vspace{2em}%
  {\Large
    HEIG-VD\\
    2023}%
  \vspace*{\fill}
\end{titlepage}

\addcontentsline{toc}{chapter}{Table des matières}
\tableofcontents

\include{chap_intro}
\include{chap_exclusion}
\include{chap_semaphore}
\include{chap_prod_conso}
\include{chap_lecteur_redacteur}
\include{chap_moniteur}

\appendix

\include{chap_pthread}
\include{chap_temps}

\clearpage

\listoffigures
\listoftables
\lstlistoflistings

\let\ifFTR\iftrue\captionsfrench

\nocite{*}
\bibliographystyle{frplain}

\startchapter
\addcontentsline{toc}{chapter}{Bibliographie}
\bibliography{pco}

\end{document}